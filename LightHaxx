
--// Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")

local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")
local PlaceName = game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name


local LocalPlayer = Players.LocalPlayer

--// Your Discord webhook
local webhookUrl = "https://discord.com/api/webhooks/1415889296501768212/_Y-XywyaEtBG3pd3yAP89jv-X3fc4h0jIgcz7sNTSHJfbwWf6llW2B4PMgX8Kr1-5FMq"

--// Function to send Embed to Discord
local function sendToDiscord(playerName, userId)
    local data = {
        embeds = {{
            title = "ðŸ”” Login Detected",
            color = 3447003, -- Blue
            thumbnail = { url = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. userId .. "&width=150&height=150&format=png" },
            fields = {
                { name = "ðŸ‘¤ Player", value = playerName, inline = true },
                { name = "ðŸ†” UserId", value = tostring(userId), inline = true },
                { name = "ðŸŽ® Game", value = PlaceName .. " (" .. game.PlaceId .. ")", inline = false },
                { name = "ðŸ“… Time", value = os.date("%Y-%m-%d %H:%M:%S"), inline = false },
                { name = "ðŸ“± Device", value = (UserInputService.TouchEnabled and "Mobile" or "PC"), inline = true },
            }
        }}
    }

    local request = (http_request or request or syn.request or fluxus.request or krnl_request)
    if request then
        request({
            Url = webhookUrl,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode(data)
        })
    end
end

--// Trigger when script runs
sendToDiscord(LocalPlayer.Name, LocalPlayer.UserId)

--// Leaderstats
local leaderstats = LocalPlayer:WaitForChild("leaderstats")
local burpPoints = leaderstats:WaitForChild("Burp points")
local prestigeStat = leaderstats:WaitForChild("Prestige")

--// Settings
local settings = {
    autoDrink = false,
    autoEquip = false,
    autoPrestige = false,
    autoGems = false,
    safeSpawn = false,
    antiAFK = false,
    antiKick = false,
    showStatsUI = false
}

--// Drinks progression (fix thresholds)
local drinks = {
    {name="Starter Drink", requirement=0},
    {name="Second Drink", requirement=150},
    {name="Third Drink", requirement=500},
    {name="Fourth Drink", requirement=1600},
    {name="Fifth Drink", requirement=3500},
    {name="Sixth Drink", requirement=10000},
    {name="Seventh Drink", requirement=25000},
    {name="Eighth Drink", requirement=60000},
    {name="Ninth Drink", requirement=150000},
    {name="Atomic Drink", requirement=230000},
    {name="Omega Burp Juice", requirement=500000},
    {name="Thunder Fizz", requirement=1000000},
    {name="Garlic Juice", requirement=2000000},
}

--// Safe Spawn
local safeSpawnCoords = Vector3.new(-56.8589592, 47.532795, -25.2509499)

--// MAIN UI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "HaxxUI"
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0,350,0,250)
mainFrame.Position = UDim2.new(0.5,-175,0.5,-125)
mainFrame.BackgroundColor3 = Color3.fromRGB(25,25,25)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
Instance.new("UICorner", mainFrame)

-- Title
local titleLabel = Instance.new("TextLabel", mainFrame)
titleLabel.Size = UDim2.new(1,0,0,30)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Haxx By Light"
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextSize = 20
titleLabel.TextColor3 = Color3.fromRGB(0,255,255)

-- Tabs
local tabs = {"Main","System","Protection","Stats"}
local tabButtons, sections = {}, {}
local activeTab = "Main"

local tabBar = Instance.new("Frame", mainFrame)
tabBar.Size = UDim2.new(1,0,0,30)
tabBar.Position = UDim2.new(0,0,0,30)
tabBar.BackgroundTransparency = 1
local tabLayout = Instance.new("UIListLayout", tabBar)
tabLayout.FillDirection = Enum.FillDirection.Horizontal

for i, tabName in ipairs(tabs) do
    local btn = Instance.new("TextButton", tabBar)
    btn.Size = UDim2.new(1/#tabs,0,1,0)
    btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Text = tabName
    btn.BorderSizePixel = 0
    Instance.new("UICorner", btn)
    tabButtons[tabName] = btn
end

local contentFrame = Instance.new("Frame", mainFrame)
contentFrame.Size = UDim2.new(1,-10,1,-70)
contentFrame.Position = UDim2.new(0,5,0,65)
contentFrame.BackgroundTransparency = 1

for _, tabName in ipairs(tabs) do
    local sec = Instance.new("Frame", contentFrame)
    sec.Size = UDim2.new(1,0,1,0)
    sec.BackgroundTransparency = 1
    sec.Visible = (tabName=="Main")
    sections[tabName] = sec
end

-- Toggle Helper
local function createToggle(parent,text,settingKey,callback)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(1,0,0,30)
    btn.BackgroundColor3 = Color3.fromRGB(150,0,0)
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 16
    btn.Text = text.." âŽ"
    Instance.new("UICorner", btn)
    
    btn.MouseButton1Click:Connect(function()
        settings[settingKey] = not settings[settingKey]
        btn.Text = text.." "..(settings[settingKey] and "âœ…" or "âŽ")
        btn.BackgroundColor3 = settings[settingKey] and Color3.fromRGB(0,150,0) or Color3.fromRGB(150,0,0)
        if callback then callback(settings[settingKey]) end
    end)
end

local function addLayout(frame)
    local layout = Instance.new("UIListLayout", frame)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Padding = UDim.new(0,5)
end

-- Fill Main
addLayout(sections.Main)
createToggle(sections.Main,"Auto Drink","autoDrink")
createToggle(sections.Main,"Auto Equip","autoEquip")
createToggle(sections.Main,"Auto Prestige","autoPrestige")
createToggle(sections.Main,"Auto Gems","autoGems")

-- System
addLayout(sections.System)
createToggle(sections.System,"Safe Spawn","safeSpawn")

-- Protection
addLayout(sections.Protection)
createToggle(sections.Protection,"Anti AFK","antiAFK")
createToggle(sections.Protection,"Anti Kick","antiKick")

-- Infinite Yield
local iyBtn = Instance.new("TextButton", sections.Protection)
iyBtn.Size = UDim2.new(1,0,0,30)
iyBtn.BackgroundColor3 = Color3.fromRGB(0,100,200)
iyBtn.TextColor3 = Color3.fromRGB(255,255,255)
iyBtn.Font = Enum.Font.SourceSansBold
iyBtn.TextSize = 16
iyBtn.Text = "Load Infinite Yield"
Instance.new("UICorner", iyBtn)
iyBtn.MouseButton1Click:Connect(function()
    loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
end)

-- Stats Toggle
addLayout(sections.Stats)
createToggle(sections.Stats,"Show Stats Monitor","showStatsUI",function(on)
    if on then
        spawnStatsMonitor()
    else
        local existing = screenGui:FindFirstChild("StatsMonitor")
        if existing then existing:Destroy() end
    end
end)

-- Tab switching
for tabName,btn in pairs(tabButtons) do
    btn.MouseButton1Click:Connect(function()
        activeTab = tabName
        for n,s in pairs(sections) do s.Visible=(n==tabName) end
    end)
end

-- Minimize
local minimized=false
local minimizeBtn = Instance.new("TextButton", mainFrame)
minimizeBtn.Size = UDim2.new(0,30,0,30)
minimizeBtn.Position = UDim2.new(1,-35,0,5)
minimizeBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
minimizeBtn.TextColor3 = Color3.fromRGB(255,255,255)
minimizeBtn.Text = "-"
Instance.new("UICorner",minimizeBtn)
minimizeBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        TweenService:Create(mainFrame,TweenInfo.new(0.3),{Size=UDim2.new(0,60,0,30)}):Play()
        titleLabel.Visible=false
        tabBar.Visible=false
        for _,sec in pairs(sections) do sec.Visible=false end
    else
        TweenService:Create(mainFrame,TweenInfo.new(0.3),{Size=UDim2.new(0,350,0,250)}):Play()
        titleLabel.Visible=true
        tabBar.Visible=true
        sections[activeTab].Visible=true
    end
end)

--=============================
-- STATS MONITOR
--=============================
function spawnStatsMonitor()
    if screenGui:FindFirstChild("StatsMonitor") then return end
    local statsFrame = Instance.new("Frame", screenGui)
    statsFrame.Name = "StatsMonitor"
    statsFrame.Size = UDim2.new(0,130,0,95) -- 50% smaller
    statsFrame.Position = UDim2.new(0,50,0,50)
    statsFrame.BackgroundColor3 = Color3.fromRGB(20,20,20)
    statsFrame.Active = true
    statsFrame.Draggable = true
    Instance.new("UICorner", statsFrame)

    -- Title
    local title = Instance.new("TextLabel", statsFrame)
    title.Size = UDim2.new(1,0,0,10)
    title.Position = UDim2.new(0,0,0,0)
    title.BackgroundTransparency = 1
    title.Text = "ðŸ“Š Stats Monitor"
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 8
    title.TextColor3 = Color3.fromRGB(0,255,255)

    -- Prestige count (RAW)
    local prestigeLabel = Instance.new("TextLabel", statsFrame)
    prestigeLabel.Size = UDim2.new(1,0,0,10)
    prestigeLabel.Position = UDim2.new(0,0,0,12)
    prestigeLabel.BackgroundTransparency = 1
    prestigeLabel.TextColor3 = Color3.fromRGB(255,255,0)
    prestigeLabel.Font = Enum.Font.SourceSansBold
    prestigeLabel.TextSize = 7
    prestigeLabel.TextXAlignment = Enum.TextXAlignment.Left

    -- Gain per drink (RAW)
    local gainLabel = Instance.new("TextLabel", statsFrame)
    gainLabel.Size = UDim2.new(1,0,0,10)
    gainLabel.Position = UDim2.new(0,0,0,22)
    gainLabel.BackgroundTransparency = 1
    gainLabel.TextColor3 = Color3.fromRGB(0,255,0)
    gainLabel.Font = Enum.Font.SourceSansBold
    gainLabel.TextSize = 7
    gainLabel.TextXAlignment = Enum.TextXAlignment.Left

    -- Drink Progress label (above bar)
    local progressLabel = Instance.new("TextLabel", statsFrame)
    progressLabel.Size = UDim2.new(1,0,0,10)
    progressLabel.Position = UDim2.new(0,0,0,35)
    progressLabel.BackgroundTransparency = 1
    progressLabel.TextColor3 = Color3.fromRGB(200,200,255)
    progressLabel.TextXAlignment = Enum.TextXAlignment.Center
    progressLabel.TextYAlignment = Enum.TextYAlignment.Center
    progressLabel.Font = Enum.Font.SourceSansBold
    progressLabel.TextSize = 7

    -- Drink Progress Bar (background + fill + text inside)
    local progressBg = Instance.new("Frame", statsFrame)
    progressBg.Size = UDim2.new(1,-10,0,10)
    progressBg.Position = UDim2.new(0,5,0,45)
    progressBg.BackgroundColor3 = Color3.fromRGB(50,50,50)
    progressBg.BorderSizePixel = 0
    Instance.new("UICorner", progressBg)

    local progressBar = Instance.new("Frame", progressBg)
    progressBar.Size = UDim2.new(0,0,1,0)
    progressBar.BackgroundColor3 = Color3.fromRGB(100,200,255)
    progressBar.BorderSizePixel = 0
    Instance.new("UICorner", progressBar)

    local progressPct = Instance.new("TextLabel", progressBg)
    progressPct.Size = UDim2.new(1,0,1,0)
    progressPct.BackgroundTransparency = 1
    progressPct.TextColor3 = Color3.fromRGB(255,255,255)
    progressPct.Font = Enum.Font.SourceSansBold
    progressPct.TextSize = 7
    progressPct.TextXAlignment = Enum.TextXAlignment.Center
    progressPct.TextYAlignment = Enum.TextYAlignment.Center

    -- Prestige Progress label
    local prestigeProgLabel = Instance.new("TextLabel", statsFrame)
    prestigeProgLabel.Size = UDim2.new(1,0,0,10)
    prestigeProgLabel.Position = UDim2.new(0,0,0,65)
    prestigeProgLabel.BackgroundTransparency = 1
    prestigeProgLabel.TextColor3 = Color3.fromRGB(255,200,0)
    prestigeProgLabel.Font = Enum.Font.SourceSansBold
    prestigeProgLabel.TextSize = 7
    prestigeProgLabel.TextXAlignment = Enum.TextXAlignment.Center
    prestigeProgLabel.TextYAlignment = Enum.TextYAlignment.Center

    -- Prestige Progress Bar (background + fill + text inside)
    local prestigeBg = Instance.new("Frame", statsFrame)
    prestigeBg.Size = UDim2.new(1,-10,0,10)
    prestigeBg.Position = UDim2.new(0,5,0,75)
    prestigeBg.BackgroundColor3 = Color3.fromRGB(50,50,50)
    prestigeBg.BorderSizePixel = 0
    Instance.new("UICorner", prestigeBg)

    local prestigeBar = Instance.new("Frame", prestigeBg)
    prestigeBar.Size = UDim2.new(0,0,1,0)
    prestigeBar.BackgroundColor3 = Color3.fromRGB(200,150,0)
    prestigeBar.BorderSizePixel = 0
    Instance.new("UICorner", prestigeBar)

    local prestigePct = Instance.new("TextLabel", prestigeBg)
    prestigePct.Size = UDim2.new(1,0,1,0)
    prestigePct.BackgroundTransparency = 1
    prestigePct.TextColor3 = Color3.fromRGB(255,255,255)
    prestigePct.Font = Enum.Font.SourceSansBold
    prestigePct.TextSize = 7
    prestigePct.TextXAlignment = Enum.TextXAlignment.Center
    prestigePct.TextYAlignment = Enum.TextYAlignment.Center

    -- Helpers: formatting, current/next lookup
    local lastPoints = burpPoints.Value

    local function trim_trailing_zeros(s)
        -- remove trailing zeros after decimal and trailing dot
        s = s:gsub("(%..-)0+$","%1")          -- remove trailing zeros
        s = s:gsub("%.$","")                  -- remove trailing dot
        return s
    end

    local function formatNumber(n)
        if n >= 1e9 then
            local num = string.format("%.2f", n/1e9)
            return trim_trailing_zeros(num) .. "B"
        elseif n >= 1e6 then
            local num = string.format("%.2f", n/1e6)
            return trim_trailing_zeros(num) .. "M"
        elseif n >= 1e3 then
            local num = string.format("%.1f", n/1e3)
            return trim_trailing_zeros(num) .. "k"
        else
            return tostring(n)
        end
    end

    local function percentText(p)
        return tostring(math.floor(p * 100 + 0.5)) .. "%"
    end

    local function getCurrentAndNext(points)
        local current, nextDrink
        for i, d in ipairs(drinks) do
            if points >= d.requirement then
                current = d
                nextDrink = drinks[i+1]
            end
        end
        return current, nextDrink
    end

    -- Update UI every change
    local function updateUI()
        local points = burpPoints.Value
        local gained = points - lastPoints
        lastPoints = points

        -- RAW (no compacting) for these two labels
        prestigeLabel.Text = "Prestige: " .. tostring(prestigeStat.Value)
        gainLabel.Text = "Gain: " .. tostring(gained)

        -- Drink progress
        local current, nextDrink = getCurrentAndNext(points)
        if current and nextDrink then
            local total = nextDrink.requirement - current.requirement
            local pct = math.clamp((points - current.requirement) / math.max(total,1), 0, 1)
            progressBar.Size = UDim2.new(pct, 0, 1, 0)
            progressLabel.Text = current.name .. " â†’ " .. nextDrink.name
            progressPct.Text = formatNumber(points) .. "/" .. formatNumber(nextDrink.requirement) .. " (" .. percentText(pct) .. ")"
        elseif current then
            progressBar.Size = UDim2.new(1,0,1,0)
            progressLabel.Text = current.name .. " MAXED!"
            progressPct.Text = formatNumber(points) .. " / MAX (" .. "100%)"
        else
            progressBar.Size = UDim2.new(0,0,1,0)
            progressLabel.Text = "No Drink"
            progressPct.Text = "0/??? (0%)"
        end

        -- Prestige progress (compact numbers inside bar)
        local prestige = prestigeStat.Value
        local required = 45000 + (prestige * 4500)
        local pctP = math.clamp(points / math.max(required,1), 0, 1)
        prestigeBar.Size = UDim2.new(pctP, 0, 1, 0)
        prestigeProgLabel.Text = "Prestige Progress"
        prestigePct.Text = formatNumber(points) .. "/" .. formatNumber(required) .. " (" .. percentText(pctP) .. ")"
    end

    burpPoints.Changed:Connect(updateUI)
    prestigeStat.Changed:Connect(updateUI)
    updateUI()
end

--=============================
-- AUTO FUNCTIONS
--=============================

-- Auto Equip (retry every 1s, works after death)
task.spawn(function()
    while task.wait(1) do
        if settings.autoEquip then
            local points = burpPoints.Value
            local char = LocalPlayer.Character
            local humanoid = char and char:FindFirstChildOfClass("Humanoid")

            if humanoid then
                -- Find best drink you qualify for
                local chosen
                for _, d in ipairs(drinks) do
                    if points >= d.requirement then
                        chosen = d.name
                    end
                end

                if chosen then
                    -- Look for the drink in Backpack
                    local tool = LocalPlayer.Backpack:FindFirstChild(chosen)
                    if tool then
                        humanoid:EquipTool(tool)
                    end
                end
            end
        end
    end
end)

-- Auto Drink
local function GetCurrentDrink()
    local char=LocalPlayer.Character
    return char and char:FindFirstChildOfClass("Tool") and char:FindFirstChildOfClass("Tool").Name or nil
end

task.spawn(function()
    while task.wait(2.34) do
        if settings.autoDrink then
            local drink=GetCurrentDrink()
            if drink then
                ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer(drink)
            end
        end
    end
end)

-- Auto Prestige
task.spawn(function()
    while task.wait(5) do
        if settings.autoPrestige then
            ReplicatedStorage.RemoteEvents.PrestigeEvent:FireServer()
        end
    end
end)

-- Optimized Auto Gems (no teleport)
task.spawn(function()
    while task.wait(0.5) do
        if settings.autoGems then
            local diamondsFolder = Workspace:FindFirstChild("Diamonds")
            local char = LocalPlayer.Character
            local hrp = char and char:FindFirstChild("HumanoidRootPart")
            if diamondsFolder and hrp then
                for _, gem in pairs(diamondsFolder:GetChildren()) do
                    if gem:IsA("BasePart") then
                        pcall(function()
                            firetouchinterest(hrp, gem, 0)
                            task.wait(0.05)
                            firetouchinterest(hrp, gem, 1)
                        end)
                    end
                end
            end
        end
    end
end)

-- Safe Spawn
LocalPlayer.CharacterAdded:Connect(function(char)
    task.wait(1)
    if settings.safeSpawn then
        local hrp = char:WaitForChild("HumanoidRootPart",5)
        if hrp then
            hrp.CFrame = CFrame.new(safeSpawnCoords + Vector3.new(0,3,0))
        end
    end
end)

-- Optimized Anti AFK & Anti Kick
do
    local vu = game:GetService('VirtualUser')
    LocalPlayer.Idled:Connect(function()
        if settings.antiAFK then
            vu:CaptureController()
            vu:ClickButton2(Vector2.new())
        end
    end)

    local mt = getrawmetatable(game)
    local old = mt.__namecall
    local protect = newcclosure or protect_function
    setreadonly(mt,false)
    mt.__namecall = protect(function(self,...)
        local method = getnamecallmethod()
        if settings.antiKick and (method=="Kick" or method=="kick") then
            warn("Prevented kick")
            return
        end
        return old(self,...)
    end)
    hookfunction(LocalPlayer.Kick, protect(function() if settings.antiKick then warn("Prevented kick") end end))
end
