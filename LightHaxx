--// Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local TeleportService = game:GetService("TeleportService")
local RunService = game:GetService("RunService")
local GuiService = game:GetService("GuiService")
local LocalPlayer = Players.LocalPlayer

--// Vars
local leaderstats = LocalPlayer:WaitForChild("leaderstats")
local burpPoints = leaderstats:WaitForChild("Burp points")
local prestigeStat = leaderstats:WaitForChild("Prestige")

--// Rainbow function
local function rainbowColor(speed)
    return Color3.fromHSV((tick() * speed) % 1, 1, 1)
end

--// Number formatting (for progress bar only)
local function formatNumber(n)
    if n >= 1e9 then
        return string.format("%.2fB", n / 1e9)
    elseif n >= 1e6 then
        return string.format("%.2fM", n / 1e6)
    elseif n >= 1e3 then
        return string.format("%.2fK", n / 1e3)
    else
        return tostring(n)
    end
end

--// UI Setup
local function createUI()
    local function safeCreate()
        if not LocalPlayer:FindFirstChild("PlayerGui") then
            return false
        end
        if LocalPlayer.PlayerGui:FindFirstChild("AutoSystemUI") then
            LocalPlayer.PlayerGui.AutoSystemUI:Destroy()
        end

        local screenGui = Instance.new("ScreenGui")
        screenGui.Name = "AutoSystemUI"
        screenGui.ResetOnSpawn = false
        screenGui.IgnoreGuiInset = true
        screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

        local function makeLabel(text, posY, color, size, width)
            local lbl = Instance.new("TextLabel")
            lbl.Text = text
            lbl.Size = UDim2.new(0, width or 220, 0, size or 18) -- shorter width
            lbl.Position = UDim2.new(0.02, 0, 0.18, posY)
            lbl.BackgroundTransparency = 1
            lbl.TextColor3 = color or Color3.fromRGB(0, 255, 0)
            lbl.Font = Enum.Font.SourceSansBold
            lbl.TextSize = size or 16
            lbl.TextXAlignment = Enum.TextXAlignment.Left
            lbl.Parent = screenGui
            return lbl
        end

        makeLabel("Automatic By Light", 0, Color3.fromRGB(0, 255, 0), 20, 220)
        makeLabel("Auto Drink ✅", 22, Color3.fromRGB(0, 255, 0), 18, 220)
        makeLabel("Auto Equip ✅", 40, Color3.fromRGB(0, 255, 0), 18, 220)
        makeLabel("Auto Rejoin ✅", 58, Color3.fromRGB(0, 255, 0), 18, 220)
        makeLabel("Auto Prestige ✅", 76, Color3.fromRGB(0, 255, 0), 18, 220)
        makeLabel("Auto Gem Collect ✅", 94, Color3.fromRGB(0, 255, 0), 18, 220)
        makeLabel("Anti AFK & Anti Kick ✅", 112, Color3.fromRGB(0, 255, 0), 18, 220)
        local gainLabel = makeLabel("Gain/Drink: 0 | Prestige: 0", 130, Color3.fromRGB(255, 0, 0), 18, 220)

        -- Prestige Progress Title
        local progressTitle = Instance.new("TextLabel")
        progressTitle.Text = "Prestige Progress"
        progressTitle.Size = UDim2.new(0, 220, 0, 18)
        progressTitle.Position = UDim2.new(0.02, 0, 0.18, 150)
        progressTitle.BackgroundTransparency = 1
        progressTitle.TextColor3 = Color3.fromRGB(0, 255, 0)
        progressTitle.Font = Enum.Font.SourceSansBold
        progressTitle.TextSize = 16
        progressTitle.TextXAlignment = Enum.TextXAlignment.Left
        progressTitle.Parent = screenGui

        -- Progress Bar Background
        local progressBarBG = Instance.new("Frame")
        progressBarBG.Size = UDim2.new(0, 220, 0, 10) -- shorter and half height
        progressBarBG.Position = UDim2.new(0.02, 0, 0.18, 170)
        progressBarBG.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        progressBarBG.BorderSizePixel = 1
        progressBarBG.Parent = screenGui

        -- Progress Bar Fill
        local progressBarFill = Instance.new("Frame")
        progressBarFill.Size = UDim2.new(0, 0, 1, 0)
        progressBarFill.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        progressBarFill.BorderSizePixel = 0
        progressBarFill.Parent = progressBarBG

        -- Progress Text inside bar
        local progressText = Instance.new("TextLabel")
        progressText.Size = UDim2.new(1, 0, 1, 0)
        progressText.BackgroundTransparency = 1
        progressText.TextColor3 = Color3.fromRGB(0, 0, 0) 
        progressText.TextStrokeColor3 = Color3.fromRGB(255, 255, 255)
        progressText.TextStrokeTransparency = 0
        progressText.Font = Enum.Font.SourceSansBold
        progressText.TextSize = 14
        progressText.Text = "0 / 0 (0%)"
        progressText.Parent = progressBarBG

        return {
            gainLabel = gainLabel,
            progressBarFill = progressBarFill,
            progressText = progressText
        }
    end

    local uiRefs
    repeat
        local success, refs = pcall(safeCreate)
        if success and refs then
            uiRefs = refs
        else
            task.wait(1)
        end
    until uiRefs

    return uiRefs
end

-- Create UI
local uiRefs = createUI()
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    uiRefs = createUI()
end)

--// Gain & Prestige tracker
local lastPoints = burpPoints.Value
local gainPerDrink = 0
local function updateGainLabel()
    if uiRefs.gainLabel then
        uiRefs.gainLabel.Text = "Gain/Drink: "..gainPerDrink.." | Prestige: "..prestigeStat.Value
    end
end

burpPoints.Changed:Connect(function(newValue)
    local diff = newValue - lastPoints
    if diff > 0 then
        gainPerDrink = diff
        updateGainLabel()
    end
    lastPoints = newValue
end)

prestigeStat.Changed:Connect(updateGainLabel)

-- Prestige Progress Update
local function updatePrestigeProgress()
    local currentPrestige = prestigeStat.Value
    local requirement = 45000 + (currentPrestige * 4500)
    local currentPoints = burpPoints.Value
    local percent = math.min(100, (currentPoints / requirement) * 100)

    if uiRefs.progressBarFill then
        uiRefs.progressBarFill.Size = UDim2.new(math.clamp(currentPoints / requirement, 0, 1), 0, 1, 0)
    end
    if uiRefs.progressText then
        uiRefs.progressText.Text = string.format("%s / %s (%.1f%%)",
            formatNumber(currentPoints),
            formatNumber(requirement),
            percent)
    end
end

burpPoints.Changed:Connect(updatePrestigeProgress)
prestigeStat.Changed:Connect(updatePrestigeProgress)
updatePrestigeProgress()

-- Rainbow Gain Label
RunService.Heartbeat:Connect(function()
    if uiRefs.gainLabel then
        uiRefs.gainLabel.TextColor3 = rainbowColor(0.5)
    end
end)

--// Helper
local function WaitForCharacter()
    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart", 10)
    return char, hrp
end

--// Auto Equip
task.spawn(function()
    while task.wait(1) do
        local char = LocalPlayer.Character
        if not char then continue end
        local humanoid = char:FindFirstChildOfClass("Humanoid")
        if not humanoid then continue end

        local points = burpPoints.Value
        local drinkName
        if points >= 2000000 then drinkName = "Garlic Juice"
        elseif points >= 1000000 then drinkName = "Thunder Fizz"
        elseif points >= 500000 then drinkName = "Omega Burp Juice"
        elseif points >= 230000 then drinkName = "Atomic Drink"
        elseif points >= 150000 then drinkName = "Ninth Drink"
        elseif points >= 60000 then drinkName = "Eighth Drink"
        elseif points >= 25000 then drinkName = "Seventh Drink"
        elseif points >= 10000 then drinkName = "Sixth Drink"
        elseif points >= 3500 then drinkName = "Fifth Drink"
        elseif points >= 1600 then drinkName = "Fourth Drink"
        elseif points >= 600 then drinkName = "Third Drink"
        elseif points >= 150 then drinkName = "Second Drink"
        else drinkName = "Starter Drink" end

        local tool = LocalPlayer.Backpack:FindFirstChild(drinkName)
        if tool then
            humanoid:EquipTool(tool)
        end
    end
end)

--// Auto Drink
task.spawn(function()
    while task.wait(2.34) do
        game.ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer("Starter Drink")
		game.ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer("Second Drink")
		game.ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer("Third Drink")
		game.ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer("Fourth Drink")
		game.ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer("Fifth Drink")
		game.ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer("Sixth Drink")
		game.ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer("Seventh Drink")
		game.ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer("Eighth Drink")
		game.ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer("Ninth Drink")
		game.ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer("Atomic Drink")
		game.ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer("Omega Burp Juice")
		game.ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer("Thunder Fizz")
		game.ReplicatedStorage.RemoteEvents.DrinkEvent:FireServer("Garlic Juice")
    end
end)

--// Auto Prestige
task.spawn(function()
    while task.wait(10) do
        ReplicatedStorage.RemoteEvents.PrestigeEvent:FireServer()
    end
end)

--// Auto Gem Collect
task.spawn(function()
    local batchSize = 2
    while task.wait(0.2) do
        local char, hrp = WaitForCharacter()
        if hrp then
            local diamondsFolder = Workspace:FindFirstChild("Diamonds")
            if diamondsFolder then
                local gems = {}
                for _, gem in pairs(diamondsFolder:GetChildren()) do
                    if gem:IsA("BasePart") then
                        table.insert(gems, gem)
                    end
                end
                for i = 1, math.min(batchSize, #gems) do
                    local gem = gems[i]
                    pcall(function()
                        firetouchinterest(hrp, gem, 0)
                        firetouchinterest(hrp, gem, 1)
                    end)
                end
            end
        end
    end
end)

--// Auto Rejoin
local function retryRejoin()
    task.spawn(function()
        while true do
            task.wait(10)
            pcall(function()
                TeleportService:Teleport(game.PlaceId, LocalPlayer)
            end)
        end
    end)
end

GuiService.ErrorMessageChanged:Connect(function(errorMessage)
    if errorMessage and errorMessage ~= "" then
        retryRejoin()
    end
end)

--// Anti-AFK
do
    local vu = game:service("VirtualUser")
    LocalPlayer.Idled:Connect(function()
        vu:CaptureController()
        vu:ClickButton2(Vector2.new())
    end)
end

--// Anti-Kick
do
    local mt = getrawmetatable(game)
    local old = mt.__namecall
    local protect = newcclosure or protect_function
    setreadonly(mt, false)
    mt.__namecall = protect(function(self, ...)
        local method = getnamecallmethod()
        if method == "Kick" then wait(9e9) return end
        return old(self, ...)
    end)
    hookfunction(LocalPlayer.Kick, protect(function() wait(9e9) end))
    setreadonly(mt, true)
end
